M.editor_tinymce=M.editor_tinymce||{};M.editor_tinymce.editor_options=M.editor_tinymce.options||{};M.editor_tinymce.filepicker_options=M.editor_tinymce.filepicker_options||{};M.editor_tinymce.initialised=false;M.editor_tinymce.init_editor=function(Y,editorid,options){if(!M.editor_tinymce.initialised){tinymce.ScriptLoader.add(M.cfg.wwwroot+'/lib/editor/tinymce/all_strings.php?elanguage='+options.language+'&rev='+options.langrev);tinymce.ui.Toolbar.prototype.oldRenderHTML=tinymce.ui.Toolbar.prototype.renderHTML;tinymce.ui.Toolbar.prototype.renderHTML=function(){if(this.controls.length==0)return;return tinymce.ui.Toolbar.prototype.oldRenderHTML.call(this)};M.editor_tinymce.initialised=true};M.editor_tinymce.editor_options[editorid]=options;if(options.moodle_init_plugins){var extraplugins=options.moodle_init_plugins.split(',');for(var i=0;i<extraplugins.length;i++){var filedetails=extraplugins[i].split(':');tinyMCE.PluginManager.load(filedetails[0],M.cfg.wwwroot+'/lib/editor/tinymce/plugins/'+filedetails[1])}};tinyMCE.init(options);var item=document.getElementById(editorid+'_filemanager');if(item)item.parentNode.removeChild(item)};M.editor_tinymce.init_filepicker=function(Y,editorid,options){M.editor_tinymce.filepicker_options[editorid]=options};M.editor_tinymce.toggle=function(id){tinyMCE.execCommand('mceToggleEditor',false,id)};M.editor_tinymce.filepicker_callback=function(args){};M.editor_tinymce.filepicker=function(target_id,url,type,win){YUI().use('core_filepicker',function(Y){var editor_id=tinyMCE.selectedInstance.editorId;if(editor_id=='mce_fullscreen')editor_id=tinyMCE.selectedInstance.settings.elements;var options=null;if(type=='media'){options=M.editor_tinymce.filepicker_options[editor_id]['media']}else if(type=='file'){options=M.editor_tinymce.filepicker_options[editor_id]['link']}else if(type=='image')options=M.editor_tinymce.filepicker_options[editor_id]['image'];options.formcallback=M.editor_tinymce.filepicker_callback;options.editor_target=win.document.getElementById(target_id);M.core_filepicker.show(Y,options)})};M.editor_tinymce.onblur_event=function(ed){if(ed.onInit!=undefined){var s=ed.settings;ed.save();var doc=s.content_editable?ed.getBody():(tinymce.isGecko?ed.getDoc():ed.getWin());tinymce.dom.Event.add(doc,'blur',function(){ed.save()})}}